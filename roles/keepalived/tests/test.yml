---
# tasks file for keepalived
- name: get default ip
  ansible.builtin.debug: 
    var: groups['thanos_new']

- name: get default ip
  ansible.builtin.debug: 
    var: VIPs.items()

- name: Setup keepalived folders
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
  loop:
    - "{{ keepalived_build_dir }}"
    - "{{ keepalived_conf_dir }}"

- name: get default ip
  ansible.builtin.debug: 
    var: VIPs.VIP_1.internal_priority

- name: get default ip
  ansible.builtin.debug: 
    var: VIPs.VIP_2.internal_priority

- name: Copy keepalived config files
  become: yes
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: 0644
  loop:
    - { src: 'keepalived-new.conf.j2', dest: '{{ keepalived_conf_dir }}/keepalived.conf' }

#- name: Clean setup folder
#  ansible.builtin.file:
#    path: "{{ keepalived_build_dir }}"
#    state: absent
